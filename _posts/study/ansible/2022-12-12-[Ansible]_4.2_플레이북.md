---
layout: post
title: "[Ansible] #4.2 - 플레이북"
subtitle: Ansible
date: '2022-12-10 17:00:00 +0900'
category: study
tags: ansible
image:
  path: /assets/img/study_Ansible/2022-12-10-[Ansible]_4.1_-플레이북/logo.png
---

`Ansible` 의 `플레이북` 의 `YAML` 형식에 대해서 알아보자.

<!--more-->

* this unordered seed list will be replaced by the toc
{:toc}

<br>

# 1. 플레이북
---

`Ansible` 플레이북 `YAML` 로 정의하고, 하나 이상의 `모듈`을 이용해 하나 이상의 `작업`을 실행하고 해당 작업을 특정 `호스트/그룹`에 실행하는 하나 이상의 `플레이`를 가짐

* `플레이북` : 하나 이상의 `플레이`를 가짐
* `플레이` : 특정 `관리 노드/그룹`을 지정해 하나 이상의 `작업`을 가짐
* `작업` : 하나의 `모듈`과 모듈의 `옵션/파라미터/아규먼트`를 지정

플레이북 키워드:<br>
[https://docs.ansible.com/ansible/latest/reference_appendices/playbooks_keywords.html#playbook-keywords](https://docs.ansible.com/ansible/latest/reference_appendices/playbooks_keywords.html#playbook-keywords)


# 2. 플레이북의 작업 실행 순서
---

1. 호스트의 패턴과 일치하는 모든 시스템에 대해 각 작업을 순서대로 실행
2. 각 직업은 지정한 모듈 옵션을 사용하여 모듈 실행
3. 하나의 작업이 호스트 패턴과 일치하는 모든 시스템에서 완료되면 다음 작업으로 이동
4. 특정 호스트에서 특정 작업이 실패하면 해당 호스트는 작업이 더 남아 있더라도 제외


# 3. 멱등성(Idempotent)
---

수학이나 IT에서 연산의 한 성질을 나타낸다.

연산/작업을 여러번 적용하더라도 결과가 달라지지 않는 성질을 의미한다.

`Ansible` 의 대부분의 모듈은 최종적으로 원하는 상태가 달성되었는지 확인하고, 이미 원하는 최종 상태를 달성했다면 작업을 실행하지 않고, 몇번의 작업을 반복 실행하더라도 최종 상태가 변경되지 않는다.

일부 모듈 및 모듈의 옵션에 따라 멱등성을 제공하지 않는 경우도 있다.

# 4. 멱등성을 제공하지 않는 예시
---

모듈 :

* command
* shell
* raw

service 모듈의 상태에 따라 :

* state : restarted

# 5. 핸들러(Handler)
---

특정 작업이 실행되어 변경 사항이 발생한 경우에만 실행해야 하는 작업이 있음, 이 작업을 핸들러라고 한다.

대표적인 예는 설정 파일을 복사해서 서비스를 재시작 해야하는 경우

서비스를 항상 재시작하는 것은 멱등성을 만족하지 못함

핸들러는 작업에 변경 사항이 발생한 경우에만 실행할 작업

# 6. 멱등성을 만족하지 못하는 예
---


# 7. 멱등성을 상황에 따라 만족하는 예
--

